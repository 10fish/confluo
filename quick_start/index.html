



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../theme/assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.0">
    
    
      
        <title>Quick Start - Confluo</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.5d3fffba.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.fbd935c7.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="light-green" data-md-color-accent="orange">
    
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Confluo" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Confluo
              </span>
              <span class="md-header-nav__topic">
                Quick Start
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/ucbrise/confluo/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Confluo
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/ucbrise/confluo/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Quick Start
      </label>
    
    <a href="./" title="Quick Start" class="md-nav__link md-nav__link--active">
      Quick Start
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" title="Pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-and-install" title="Download and Install" class="md-nav__link">
    Download and Install
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-confluo" title="Using Confluo" class="md-nav__link">
    Using Confluo
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#embedded-mode" title="Embedded Mode" class="md-nav__link">
    Embedded Mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stand-alone-mode" title="Stand-alone Mode" class="md-nav__link">
    Stand-alone Mode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../modes_of_operation/" title="Modes of Operation" class="md-nav__link">
      Modes of Operation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Data Storage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="5">
      <label class="md-nav__title" for="nav-2-4">
        Data Storage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../loading_data/" title="Data Storage Overview" class="md-nav__link">
      Data Storage Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../type_system/" title="Type System" class="md-nav__link">
      Type System
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      Querying Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="6">
      <label class="md-nav__title" for="nav-2-5">
        Querying Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/" title="Queries Overview" class="md-nav__link">
      Queries Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../online_queries/" title="Online Queries" class="md-nav__link">
      Online Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../offline_queries/" title="Offline Queries" class="md-nav__link">
      Offline Queries
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data_archival/" title="Archiving Data" class="md-nav__link">
      Archiving Data
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      API Docs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        API Docs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cpp_api/" title="C++" class="md-nav__link">
      C++
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Client APIs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-2">
        Client APIs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../client_api/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cpp_client_api/" title="C++" class="md-nav__link">
      C++
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python_client_api/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../java_client_api/" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" title="Pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-and-install" title="Download and Install" class="md-nav__link">
    Download and Install
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-confluo" title="Using Confluo" class="md-nav__link">
    Using Confluo
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#embedded-mode" title="Embedded Mode" class="md-nav__link">
    Embedded Mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stand-alone-mode" title="Stand-alone Mode" class="md-nav__link">
    Stand-alone Mode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ucbrise/confluo/edit/master/docs/quick_start.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="quick-start">Quick Start<a class="headerlink" href="#quick-start" title="Permanent link">&para;</a></h1>
<p>In this Quick Start, we will take a look at how to download and setup Confluo,
load some sample data, and query it.</p>
<h2 id="pre-requisites">Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permanent link">&para;</a></h2>
<ul>
<li>MacOS X or Unix-based OS; Windows is not yet supported.</li>
<li>C++ compiler that supports C++11 standard</li>
<li>CMake 2.8 or later</li>
<li>Boost 1.53 or later</li>
</ul>
<p>For python client, you will additionally require:</p>
<ul>
<li>Python 2.7 or later</li>
<li>Python Packages: six 1.7.2 or later</li>
</ul>
<p>For java client, you will additionally require:</p>
<ul>
<li>Java 1.7 or later</li>
<li>ant 1.6.2 or later</li>
</ul>
<h2 id="download-and-install">Download and Install<a class="headerlink" href="#download-and-install" title="Permanent link">&para;</a></h2>
<p>To download and install Confluo, use the following commands:</p>
<div class="codehilite"><pre><span></span>git clone https://github.com/ucbrise/confluo.git
<span class="nb">cd</span> confluo
mkdir build
<span class="nb">cd</span> build
cmake ..
make -j <span class="o">&amp;&amp;</span> make <span class="nb">test</span> <span class="o">&amp;&amp;</span> make install
</pre></div>


<h2 id="using-confluo">Using Confluo<a class="headerlink" href="#using-confluo" title="Permanent link">&para;</a></h2>
<p>Confluo can be used in two modes -- embedded and stand-alone. In the embedded mode,
Confluo is used as a header-only library in C++, allowing Confluo to use the same
address-space as the application process. In the stand-alone mode, Confluo runs
as a daemon server process, allowing clients to communicate with it using 
<a href="https://thrift.apache.org">Apache Thrift</a> protocol.</p>
<h3 id="embedded-mode">Embedded Mode<a class="headerlink" href="#embedded-mode" title="Permanent link">&para;</a></h3>
<p>In order to use Confluo in the embedded mode, we simply need to include
Confluo's header files under libconfluo/confluo, use the Confluo C++ API in 
a C++ application, and compile using a modern C++ compiler. The entry point 
header file to include is <code>confluo_store.h</code>. </p>
<p>We will first create a new Confluo Store with the data path for it to use 
as follows:</p>
<div class="codehilite"><pre><span></span><span class="n">confluo</span><span class="o">::</span><span class="n">confluo_store</span> <span class="n">store</span><span class="p">(</span><span class="s">&quot;/path/to/data&quot;</span><span class="p">);</span>
</pre></div>


<p>We then create a new Atomic MultiLog within the Store (synonymous to a database
table); this requires three parameters: name, schema, and the storage mode:</p>
<div class="codehilite"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">schema</span><span class="p">(</span><span class="s">&quot;{ type: CHAR, msg: STRING(100) }&quot;</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">storage_mode</span> <span class="o">=</span> <span class="n">confluo</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">IN_MEMORY</span><span class="p">;</span>
<span class="n">store</span><span class="p">.</span><span class="n">create_atomic_multilog</span><span class="p">(</span><span class="s">&quot;my_multilog&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">storage_mode</span><span class="p">);</span>
</pre></div>


<p>Our simple schema only contains two attributes: a character type attribute, and 
a string message field. Confluo will also automatically create a timestamp 
field if the schema does not explicityly specify one. </p>
<p>We then obtain a reference to our newly created Atomic MultiLog:</p>
<div class="codehilite"><pre><span></span><span class="n">confluo</span><span class="o">::</span><span class="n">atomic_multilog</span><span class="o">*</span> <span class="n">mlog</span> <span class="o">=</span> <span class="n">store</span><span class="p">.</span><span class="n">get_atomic_multilog</span><span class="p">(</span><span class="s">&quot;my_multilog&quot;</span><span class="p">);</span>
</pre></div>


<p>We can define indexes on the Atomic MultiLog as follows:</p>
<div class="codehilite"><pre><span></span><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">add_index</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span>
</pre></div>


<p>to add an index on "type" attribute. We can also install filters as follows:</p>
<div class="codehilite"><pre><span></span><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">add_filter</span><span class="p">(</span><span class="s">&quot;type_a&quot;</span><span class="p">,</span> <span class="s">&quot;type == a&quot;</span><span class="p">);</span>
</pre></div>


<p>to explicitly filter out records that have the "type" attribute value "a", using
a filter named "type_a". </p>
<p>Additionally, we can add aggregates on filters as follows:</p>
<div class="codehilite"><pre><span></span><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">add_aggregate</span><span class="p">(</span><span class="s">&quot;latest_a&quot;</span><span class="p">,</span> <span class="s">&quot;type_a&quot;</span><span class="p">,</span> <span class="s">&quot;MAX(timestamp)&quot;</span><span class="p">)</span>
</pre></div>


<p>This adds a new stored aggregate "latest_a" on the filter "type_a" we defined 
before. In essence, it records the latest timestamp of any record that has the
type attribute value "a".</p>
<p>Finally, we can add a trigger on aggregates as follows:</p>
<div class="codehilite"><pre><span></span><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">add_trigger</span><span class="p">(</span><span class="s">&quot;trigger_a&quot;</span><span class="p">,</span> <span class="s">&quot;lastest_a &gt; 0&quot;</span><span class="p">);</span>
</pre></div>


<p>This adds a trigger "trigger_a" on the aggregate "latest_a", which should 
generate an alert whenever the condition latest_a &gt; 0 is satisfied, i.e.,
whenever any record with  type = a is written to the Atomic MultiLog.</p>
<p>We are now ready to load some data into this multilog:</p>
<div class="codehilite"><pre><span></span><span class="kt">size_t</span> <span class="n">off1</span> <span class="o">=</span> <span class="n">mlog</span><span class="o">-&gt;</span><span class="n">append</span><span class="p">({</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;Hello World!&quot;</span><span class="p">);</span>
<span class="kt">size_t</span> <span class="n">off2</span> <span class="o">=</span> <span class="n">mlog</span><span class="o">-&gt;</span><span class="n">append</span><span class="p">({</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;How are you doing today?&quot;</span><span class="p">);</span>
<span class="kt">size_t</span> <span class="n">off3</span> <span class="o">=</span> <span class="n">mlog</span><span class="o">-&gt;</span><span class="n">append</span><span class="p">({</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;Good to see you!&quot;</span><span class="p">});</span>
</pre></div>


<p>Note that the <code>append</code> method takes a vector of strings as its input, where
the vector corresponds to a single record. The number of entries in the
vector must match the number of entries in the schema, with the exception
of the timestamp --- if the timestamp is not provided, Confluo will automatically
assign one.</p>
<p>Also note that the operation returns a unique offset corresponding to each append
operation. This forms the "key" for records stored in the Atomic MultiLog -- records
can be retrieved by specifying their corresponding offsets.</p>
<p>Now we take a look at how we can query the data in the Atomic MultiLog. First,
it is straightforward to retrieve records given their offsets:</p>
<div class="codehilite"><pre><span></span><span class="k">auto</span> <span class="n">record1</span> <span class="o">=</span> <span class="n">mlog</span><span class="o">-&gt;</span><span class="n">read</span><span class="p">(</span><span class="n">off1</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">record2</span> <span class="o">=</span> <span class="n">mlog</span><span class="o">-&gt;</span><span class="n">read</span><span class="p">(</span><span class="n">off2</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">record3</span> <span class="o">=</span> <span class="n">mlog</span><span class="o">-&gt;</span><span class="n">read</span><span class="p">(</span><span class="n">off3</span><span class="p">);</span>
</pre></div>


<p>Each of <code>record1</code>, <code>record2</code>, and <code>record3</code> are vectors of strings.</p>
<p>We can query indexed attributes as follows:</p>
<div class="codehilite"><pre><span></span><span class="k">auto</span> <span class="n">record_stream1</span> <span class="o">=</span> <span class="n">mlog</span><span class="o">-&gt;</span><span class="n">execute_filter</span><span class="p">(</span><span class="s">&quot;type == b&quot;</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">s</span> <span class="o">=</span> <span class="n">record_stream1</span><span class="p">;</span> <span class="o">!</span><span class="n">s</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">tail</span><span class="p">())</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">head</span><span class="p">().</span><span class="n">to_string</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>


<p>Note that the operation returns a lazily evaluated stream, which supports
functional style operations like map, filter, etc. See 
<a href="https://github.com/ucbrise/confluo/blob/single-machine/libconfluo/confluo/container/lazy/stream.h">stream.h</a>
for more details.</p>
<p>We can also query the defined filter as follows:</p>
<div class="codehilite"><pre><span></span><span class="k">auto</span> <span class="n">record_stream2</span> <span class="o">=</span> <span class="n">mlog</span><span class="o">-&gt;</span><span class="n">query_filter</span><span class="p">(</span><span class="s">&quot;type_a&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">UINT64_MAX</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">s</span> <span class="o">=</span> <span class="n">record_stream2</span><span class="p">;</span> <span class="o">!</span><span class="n">s</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">tail</span><span class="p">())</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">head</span><span class="p">().</span><span class="n">to_string</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>


<p>The first parameter corresponds to the name of the filter to be queried, while 
the second and third parameters correspond to the begining timestamp and end 
timestamp to consider for records in the filter. We've specified them to capture
all possible values of timestamp. Similar to the <code>execute_filter</code> query, this
operation also returns a lazily evaluated record stream.</p>
<p>We query aggregates as follows:</p>
<div class="codehilite"><pre><span></span><span class="k">auto</span> <span class="n">value</span> <span class="o">=</span> <span class="n">mlog</span><span class="o">-&gt;</span><span class="n">get_aggregate</span><span class="p">(</span><span class="s">&quot;latest_a&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">UINT64_MAX</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">.</span><span class="n">to_string</span><span class="p">();</span>
</pre></div>


<p>The query takes the name of the aggregate as its first parameter, while the 
second and third parameters correspond to begin and end timestmaps, as before.
The query returns a <a href="../../libconfluo/confluo/types/numeric.h"><code>numeric</code></a> object,
which is a wrapper around numeric values.</p>
<p>Finally, we can query the generated alerts by triggers we have installed as 
follows:</p>
<div class="codehilite"><pre><span></span><span class="k">auto</span> <span class="n">alert_stream</span> <span class="o">=</span> <span class="n">mlog</span><span class="o">-&gt;</span><span class="n">get_alerts</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UINT64_MAX</span><span class="p">,</span> <span class="s">&quot;trigger_a&quot;</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">s</span> <span class="o">=</span> <span class="n">alert_stream</span><span class="p">;</span> <span class="o">!</span><span class="n">s</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">tail</span><span class="p">())</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">head</span><span class="p">().</span><span class="n">to_string</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>


<p>The query takes and begin and end timestamps as its first and second arguments,
and an optional trigger name as its third argument. The query returns a lazy 
stream over generated alerts for this trigger in the specified time-range.</p>
<p>See <a href="https://github.com/ucbrise/confluo/blob/single-machine/libconfluo/confluo/conflu_store.h"><code>confluo_store.h</code></a>
and <a href="https://github.com/ucbrise/confluo/blob/single-machine/libconfluo/confluo/atomic_multilog.h"><code>atomic_multilog.h</code></a>
to see all the APIs described here, along with variations and other caveats.</p>
<h3 id="stand-alone-mode">Stand-alone Mode<a class="headerlink" href="#stand-alone-mode" title="Permanent link">&para;</a></h3>
<p>In the stand-alone mode, Confluo runs as a daemon server, serving client requests
using Apache Thrift protocol. To start the server, run:</p>
<div class="codehilite"><pre><span></span>confuod
</pre></div>


<p>you can find options supported by the binary using:</p>
<div class="codehilite"><pre><span></span>confluod --help
</pre></div>


<p>Once the server daemon is running, you can query it using the C++ or Python 
client APIs. The client APIs closely resemble the embedded API, and can be
found <a href="https://github.com/ucbrise/confluo/blob/single-machine/librpc/rpc/rpc_client.h">here</a> 
for the C++ Client, and <a href="https://github.com/ucbrise/confluo/blob/single-machine/pyclient/confluo/rpc/rpc_client.py">here</a> 
for the Python Client.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Overview" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Overview
              </span>
            </div>
          </a>
        
        
          <a href="../install/" title="Installation" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Installation
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.e8b9464e.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>